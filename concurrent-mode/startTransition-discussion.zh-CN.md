# 新特性：startTransition

> 原 Discussion：https://github.com/reactwg/react-18/discussions/41

## 概述

在 React18 中我们引进了一个新 API，让应用即便在大屏更新场景下仍能保持响应。这个新 API 通过将指定的更新标记为“transition”来大幅提高用户交互体验。React 会让你提供 state 转变时的视觉反馈并在转变过程中保持浏览器可响应。

* [真实案例：为慢渲染加入 startTransition](https://github.com/reactwg/react-18/discussions/65)

## 解决什么问题？

构建流畅的、可响应的 APP 并不是件容易的事。有时一些很小的行为，比如点按钮或是往输入框中输内容，却会导致屏幕上有很多事发生。这些事在执行时可能会导致页面卡死。

设想，在输入框输入值，然后过滤一个数据列表。你需要将字段值存在 state 中，以便用它来过滤数据并且控制输入框的值。代码就像这样：

```js
// 更新 input 的值并搜索结果
setSearchQuery(input);
```

这样的话，每当输入一个新字符，就会更新输入框的值并且用这个新值去搜索列表、显示结果。

对于大屏更新场景，这会导致页面更新的延迟，从而任何要渲染的、输入的以及其他交互形式都会觉得慢，觉得没响应。即便数据列表不是很长，但每一个列表项可能很复杂，随着一次次的键盘敲击，它们不停地变化，没有一个清晰的方式来优化渲染。

抽象来看，问题的原因是发生了两个不同的更新：

* 改变输入框的值，有时还会涉及一些潜在的 UI 更新。这是紧急的更新；
* 显示搜索结果。这是非紧急的更新；

```js
// 紧急：显示我们输入了什么
setInputValue(input);

// 非紧急：显示搜索结果
setSearchQuery(input);
```

用户期望紧急的更新立刻执行，因为原生浏览器处理这些交互就很快。但非紧急的更新可以有一些延迟，由于有很多事要处理，用户并不奢望它们能立刻完成。（事实上，Developer 们也经常会用类似防抖这样的技术手段来人为延迟）

React18 前，所有更新都是紧急渲染的。意味着上面两种更新都是在一次更新中同时进行的，这会一直阻塞用户看到交互反馈，直到一切都渲染完毕。我们欠缺的是一种机制，可以告知 React 哪些更新紧急，哪些又不紧急。
